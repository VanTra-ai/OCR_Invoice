<!-- imglab/tags/toolbox.tag.html -->
<toolbox>
  <style>
    .tool-button {
      text-align: center;
      margin: 14px 0px;
      font-size: 0.9em;
      cursor: pointer; /* Thêm con trỏ tay */
    }
    .tool-icon {
      width: 40%;
      margin: 3px 0px;
      font-size: 1.5em;
    }
    .tool-selected {
      background: coral;
    }
    .tool-button:not(.tool-selected):hover {
      background: grey;
    }
  </style>

  <div
    each="{tool, toolid in tools[opts.tools]}"
    id="{toolid}"
    class="tool-button"
    onclick="{selectme}"
    title="{tool.title}"
  >
    <img if={tool.icon} class="tool-icon" src={"img/icons/" + tool.icon} /> <i
    if={tool.icon_font} class={"tool-icon " + tool.icon_font} />
    <div>{tool.title}</div>
  </div>

  <script>
    var tag = this;

    this.on("mount", function () {
      // Đăng ký phím tắt chuyển đổi công cụ
      document.addEventListener("keydown", (e) => {
        // Nếu đang nhập liệu (input text), không kích hoạt phím tắt công cụ
        if ($(e.target).is('input[type="text"]')) return;

        // Alt + R: Rectangle (Vẽ hình chữ nhật)
        if (e.key == "r" && e.altKey) {
          $("#tool-rectangle").click();
          e.preventDefault();
          e.stopPropagation();
        }

        // Alt + M: Move (Di chuyển)
        if (e.key == "m" && e.altKey) {
          $("#tool-move").click();
          e.preventDefault();
          e.stopPropagation();
        }
        $("#tool-rectangle").click();
      });
    });

    tag.selectme = function (e) {
      $(".tool-selected").removeClass("tool-selected");

      // Lấy thông tin công cụ từ biến toàn cục tools
      var toolDetail = tools[opts.tools][e.item.toolid];

      if (toolDetail.selectAction) {
        toolDetail.selectAction();
      } else {
        selectedTool = toolDetail;
        $(e.currentTarget).addClass("tool-selected");
      }

      // Nếu công cụ có thanh hành động phụ (như Zoom), mount nó
      if (toolDetail.actions) {
        riot.mount("actionbar", { actions: toolDetail.actions });
      }
    };
  </script>
</toolbox>
