<!-- imglab/tags/label-panel.tag.html -->
<label-panel>
  <style>
    .panel-header {
      padding: 10px;
      background-color: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      font-weight: bold;
      color: #333;
    }
    .panel-body {
      padding: 0px;
      overflow-y: auto;
      height: calc(100% - 50px);
    }
  </style>

  <div
    class="d-flex flex-column"
    style="height: 100%; background: #fff; border-left: 1px solid #ccc"
  >
    <div class="panel-header">Annotation Details</div>

    <div class="panel-body">
      <attributes-list></attributes-list>
    </div>
  </div>

  <script>
    var tag = this;

    // 1. Lấy dữ liệu hình từ Store dựa trên ID được truyền vào
    // opts.id là ID của hình (ví dụ: rect1, rect2...)
    tag.targetShape = getShape(this.opts.id);

    this.on("mount", function () {
      console.log("Label Panel Mounted for:", tag.opts.id);

      if (tag.targetShape) {
        // 2. Đảm bảo mảng attributes luôn tồn tại
        if (!tag.targetShape.attributes) {
          tag.targetShape.attributes = [];
        }

        // 3. Tự động thêm dòng trống nếu chưa có dữ liệu (để nhập ngay)
        if (tag.targetShape.attributes.length === 0) {
          tag.targetShape.attributes.push({
            label: "",
            value: "",
          });
        }

        // 4. Mount component con và truyền dữ liệu vào
        riot.mount(tag.root.querySelector("attributes-list"), {
          attributes: tag.targetShape.attributes,
          shapeId: tag.opts.id,
        });
      } else {
        console.error("Không tìm thấy dữ liệu cho hình có ID:", tag.opts.id);
      }

      // Lắng nghe sự kiện đóng panel
      eventBus.on("unmountLabelPanel", () => {
        tag.unmount(true);
      });

      eventBus.on("removeLabelPanelTag", () => {
        var shapeExists = getShape(tag.opts.id);
        if (!shapeExists) {
          tag.unmount(true);
        } else {
          tag.update();
        }
      });
    });

    this.on("unmount", function () {
      eventBus.off("removeLabelPanelTag");
      eventBus.off("unmountLabelPanel");
    });
  </script>
</label-panel>
