<!-- imglab/tags/settings-window.tag.html -->
<settings-window>
  <style>
    #settings-wrapper {
      min-height: 300px;
      overflow-x: hidden;
    }
    .setting {
      margin-top: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .setting-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .setting-desc {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 10px;
      display: block;
    }
    input[type="text"] {
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 2px 5px;
    }
  </style>

  <div id="settings-wrapper">
    <h4 class="mb-3">Settings</h4>

    <ul class="nav nav-tabs" id="settingsTab" role="tablist">
      <li class="nav-item">
        <a
          class="nav-link active"
          id="general-tab"
          data-toggle="tab"
          href="#general"
          role="tab"
          >General</a
        >
      </li>
    </ul>

    <div class="tab-content" id="settingsTabContent" style="padding: 15px">
      <div class="tab-pane fade show active" id="general" role="tabpanel">
        <div class="setting">
          <div class="setting-title">Auto Save Interval</div>
          <small class="setting-desc"
            >Automatically save labeling data to browser cache (Set 0 to
            disable).</small
          >

          <div class="row align-items-center">
            <div class="col-8">Syncing Interval (Seconds):</div>
            <div class="col-4 text-right">
              <input type="text" value={ appConfig.autosave.syncingInterval /
              1000 } size=4 onchange={changeInterval}>
            </div>
          </div>

          <div class="mt-2 text-right">
            <button
              class="btn btn-sm btn-outline-danger"
              onclick="{clearCache}"
            >
              Clear Cache
            </button>
          </div>
        </div>

        <div class="setting">
          <div class="setting-title">Default Zoom Level</div>
          <small class="setting-desc"
            >Set the initial zoom level when opening an image.</small
          >

          <div class="row align-items-center">
            <div class="col-8">Zoom (%):</div>
            <div class="col-4 text-right">
              <input type="text" value={ localStorage.getItem("zoom") !== null ?
              localStorage.getItem("zoom") * 100 : 100} size=4
              onchange={updateZoom}>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    this.updateZoom = (e) => {
      let newVal = e.target.value / 100;
      if (newVal >= 0.1) localStorage.setItem("zoom", String(newVal));
    };

    this.changeInterval = function (e) {
      var val = parseInt(e.target.value);
      if (val === 0) {
        appConfig.autosave.enable = false;
      } else {
        appConfig.autosave.enable = true;
        // Tối thiểu là 4 giây để tránh lag trình duyệt
        var seconds = val < 4 ? 4 : val;
        appConfig.autosave.syncingInterval = seconds * 1000;

        // Cập nhật lại giá trị hiển thị nếu người dùng nhập < 4
        if (val < 4 && val > 0) e.target.value = 4;
      }
    };

    this.clearCache = function () {
      if (confirm("Are you sure you want to clear all cached data?")) {
        localStorage.removeItem("labellingData");
        location.reload();
      }
    };
  </script>
</settings-window>
